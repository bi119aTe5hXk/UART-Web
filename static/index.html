<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>UART Monitor</title>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
<style>
body { font-family: monospace; background: #111; color: #eee; }
.device { border: 1px solid #444; padding: 10px; margin-bottom: 20px; }
pre { height: 300px; overflow-y: scroll; background: #000; padding: 10px; white-space: pre-wrap; color: #0f0; }
input { width: 200px; }
button { margin-left: 5px; }
</style>
</head>
<body>

<h1>UART Web Console</h1>
<div id="containers"></div>

<script>
const DEVICES = ["device1", "device2"];
const socket = io();

function createUI() {
    const container = document.getElementById("containers");
    DEVICES.forEach(dev => {
        container.innerHTML += `
            <div class="device">
                <h2>${dev}</h2>
                <pre id="log_${dev}"></pre>
                <input id="input_${dev}" placeholder="Type command...">
                <button onclick="sendCmd('${dev}')">Send</button>
                <a href="/logs/${dev}.log" download>Download Log</a>
            </div>
        `;
    });
}
createUI();

socket.on("log", msg => {
    const pre = document.getElementById("log_" + msg.device);
    if(pre){
        pre.textContent += msg.text;
        pre.scrollTop = pre.scrollHeight;
    }
});

function sendCmd(device){
    const input = document.getElementById("input_" + device);
    const cmd = input.value;
    if(cmd){
        socket.emit("send", {device: device, cmd: cmd});
        input.value = "";
    }
}
</script>

</body>
</html>
